!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.yNot={})}(this,function(e){let t,n=!1;class s{constructor(e={}){Object.entries(e).forEach(([e,t])=>this[e]=t)}toString(){return JSON.stringify(this)}setValue(e,t){return this[e]=t,this}}function o(e){const t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(`${e.nodeName}.${e.attributes.class.replace(/ /g,".")}`),e.attributes.id&&t.push(`${e.nodeName}#${e.attributes.id}`))),t}function i(e){const t={},n={};return e.forEach(e=>{o(e).forEach(e=>{const s=e in t;s||e in n?s&&(delete t[e],n[e]=!0):t[e]=!0})}),t}function a(e,t){const n=i(e),s=i(t),o={};return Object.keys(n).forEach(e=>{s[e]&&(o[e]=!0)}),o}function r(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(r)}function l(e,t){if(!["nodeName","value","checked","selected","data"].every(n=>e[n]===t[n]))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){const n=Object.keys(e.attributes),s=Object.keys(t.attributes);if(n.length!==s.length)return!1;if(!n.every(n=>e.attributes[n]===t.attributes[n]))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every((e,n)=>l(e,t.childNodes[n])))return!1}return!0}function c(e,t,n,s,o){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!o||e.data===t.data;if(e.nodeName in n)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(`${e.nodeName}#${e.attributes.id}`in n)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class){if(`${e.nodeName}.${e.attributes.class.replace(/ /g,".")}`in n)return!0}}if(s)return!0;const i=e.childNodes?e.childNodes.slice().reverse():[],r=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==r.length)return!1;if(o)return i.every((e,t)=>e.nodeName===r[t].nodeName);{const e=a(i,r);return i.every((t,n)=>c(t,r[n],e,!0,!0))}}function u(e){return JSON.parse(JSON.stringify(e))}function h(e,t,n,s){let i=0,r=[];const l=e.length,u=t.length,h=Array(...new Array(l+1)).map(()=>[]),d=a(e,t);let f=l===u;f&&e.some((e,n)=>{const s=o(e),i=o(t[n]);return s.length!==i.length?(f=!1,!0):(s.some((e,t)=>{if(e!==i[t])return f=!1,!0}),!f||void 0)});for(let o=0;o<l;o++){const a=e[o];for(let e=0;e<u;e++){const l=t[e];n[o]||s[e]||!c(a,l,d,f)?h[o+1][e+1]=0:(h[o+1][e+1]=h[o][e]?h[o][e]+1:1,h[o+1][e+1]>=i&&(i=h[o+1][e+1],r=[o+1,e+1]))}}return 0!==i&&{oldValue:r[0]-i,newValue:r[1]-i,length:i}}function d(e,t){return Array(...new Array(e)).map(()=>t)}function f(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}class p{constructor(){this.list=[]}add(e){this.list.push(...e)}forEach(e){this.list.forEach(t=>e(t))}}function m(e){return function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e)?JSON.stringify(function(e){return Object.keys(e).sort().reduce(function(t,n){var s;return Object.assign({},t,((s={})[n]=e[n],s))},{})}(function(e){return Object.entries(e).reduce(function(e,t){var n,s=t[1];return"function"==typeof s?e:Object.assign({},e,((n={})[t[0]]=s,n))},{})}(e))):JSON.stringify(e)}function _(e,t){return e.reduce(function(e,n,s){var o=m(n),i=t.findIndex(function(e){return m(e)===o});if(i>-1)return e.concat([[s,i]])},[])}var V=function(){return/^<([a-z]+)([^>]*?)(\/?>|(>([\s\S]*?)<\/\1>))$/i};function g(e){if("jQuery"in window)return $(e)[0];var t,n,s=(t=e.trim(),(n=t.match(V()))?{tag:n[1],attributes:n[2]||"",innerHTML:n[5]||""}:null);if(!s)throw new Error("source: "+e+"; Not a valid element! check render()");var o=document.createElement(s.tag);o.innerHTML=s.innerHTML;var i=s.attributes;if(i){var a={};i.trim().replace(/([a-zA-Z]+)=([^'"]+|(['"])([^'"]+)\3)/g,function(e,t,n){return a[t]=n.replace(/['"]/g,""),e}),Object.entries(a).forEach(function(e){o.setAttribute(e[0],e[1])})}return o}function v(e,t){for(var n=[],s=arguments.length-2;s-- >0;)n[s]=arguments[s+2];var o=Array.isArray(t)?t.concat(n):[t].concat(n);if("jQuery"in window)$(e).replaceWith(o);else{var i=e.parentElement;if(i){if(!o.length)throw new Error("Need to provide new DOM!");for(var a=e,r=o.length-1;r>=0;r--){var l=o[r];i.insertBefore(l,a),a=l}i.removeChild(e)}}}function b(e,t){return void 0===t&&(t=document),"jQuery"in window?$(t).find(e)[0]:t.querySelector(e)}var y,N={activeComponent:null,componentArray:[],stateList:[],effectList:[],components:function(){return{}},makeState:function(){return N.stateList.reduce(function(e,t,n){var s;return Object.assign({},e,((s={})[n]=t,s))},{})},clear:function(){N.stateList=[],N.effectList=[],N.components=function(){return{}}}},w=new class{constructor({debug:e=!1,diffcap:t=10,maxDepth:n=!1,maxChildCount:s=50,maxChildDiffCount:o=3,valueDiffing:i=!0,textDiff:a=function(){arguments[0].data=arguments[3]},preVirtualDiffApply:r=function(){},postVirtualDiffApply:l=function(){},preDiffApply:c=function(){},postDiffApply:u=function(){},filterOuterDiff:h=null,compress:d=!1}){this.debug=e,this.diffcap=t,this.maxDepth=n,this.maxChildCount=s,this.maxChildDiffCount=o,this.valueDiffing=i,this.textDiff=a,this.preVirtualDiffApply=r,this.postVirtualDiffApply=l,this.preDiffApply=c,this.postDiffApply=u,this.filterOuterDiff=h,this.compress=d;const f=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this._const={},f.forEach(this.compress?(e,t)=>this._const[e]=t:e=>this._const[e]=e)}diff(e,n){const s=this.nodeToObj(e),o=this.nodeToObj(n);return t=0,this.debug&&(this.t1Orig=this.nodeToObj(e),this.t2Orig=this.nodeToObj(n)),this.tracker=new p,this.findDiffs(s,o)}findDiffs(e,s){let o;do{if(this.debug&&(t+=1)>this.diffcap)throw window.diffError=[this.t1Orig,this.t2Orig],new Error(`surpassed diffcap:${JSON.stringify(this.t1Orig)} -> ${JSON.stringify(this.t2Orig)}`);0===(o=this.findNextDiff(e,s,[])).length&&(l(e,s)||(n?(console.error("Could not find remaining diffs!"),console.log({t1:e,t2:s})):(n=!0,r(e),o=this.findNextDiff(e,s,[])))),o.length>0&&(n=!1,this.tracker.add(o),this.applyVirtual(e,o))}while(o.length>0);return this.tracker.list}findNextDiff(e,t,n){let s,o;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!e.outerDone){if(s=this.findOuterDiff(e,t,n),this.filterOuterDiff&&(o=this.filterOuterDiff(e,t,s))&&(s=o),s.length>0)return e.outerDone=!0,s;e.outerDone=!0}if(!e.innerDone){if((s=this.findInnerDiff(e,t,n)).length>0)return s;e.innerDone=!0}if(this.valueDiffing&&!e.valueDone){if((s=this.findValueDiff(e,t,n)).length>0)return e.valueDone=!0,s;e.valueDone=!0}return[]}findOuterDiff(e,t,n){const o=[];let i,a,r,c,h,d;if(e.nodeName!==t.nodeName)return[(new s).setValue(this._const.action,this._const.replaceElement).setValue(this._const.oldValue,u(e)).setValue(this._const.newValue,u(t)).setValue(this._const.route,n)];if(n.length&&this.maxChildCount&&e.childNodes&&t.childNodes&&e.childNodes.length>this.maxChildCount&&t.childNodes.length>this.maxChildCount){const o=e.childNodes.length<t.childNodes.length?e.childNodes.length:t.childNodes.length;let i=0,a=0;for(;i<this.maxChildDiffCount&&a<o;)l(e.childNodes[a],t.childNodes[a])||i++,a++;if(i===this.maxChildDiffCount)return[(new s).setValue(this._const.action,this._const.replaceElement).setValue(this._const.oldValue,u(e)).setValue(this._const.newValue,u(t)).setValue(this._const.route,n)]}if(e.data!==t.data)return"#text"===e.nodeName?[(new s).setValue(this._const.action,this._const.modifyTextElement).setValue(this._const.route,n).setValue(this._const.oldValue,e.data).setValue(this._const.newValue,t.data)]:[(new s).setValue(this._const.action,this._const.modifyComment).setValue(this._const.route,n).setValue(this._const.oldValue,e.data).setValue(this._const.newValue,t.data)];for(a=e.attributes?Object.keys(e.attributes).sort():[],r=t.attributes?Object.keys(t.attributes).sort():[],c=a.length,d=0;d<c;d++)-1===(h=r.indexOf(i=a[d]))?o.push((new s).setValue(this._const.action,this._const.removeAttribute).setValue(this._const.route,n).setValue(this._const.name,i).setValue(this._const.value,e.attributes[i])):(r.splice(h,1),e.attributes[i]!==t.attributes[i]&&o.push((new s).setValue(this._const.action,this._const.modifyAttribute).setValue(this._const.route,n).setValue(this._const.name,i).setValue(this._const.oldValue,e.attributes[i]).setValue(this._const.newValue,t.attributes[i])));for(c=r.length,d=0;d<c;d++)i=r[d],o.push((new s).setValue(this._const.action,this._const.addAttribute).setValue(this._const.route,n).setValue(this._const.name,i).setValue(this._const.value,t.attributes[i]));return o}nodeToObj(e){const t={},n=this;let s,o,i,a,r;if(t.nodeName=e.nodeName,"#text"===t.nodeName||"#comment"===t.nodeName)t.data=e.data;else{if(e.attributes&&e.attributes.length>0)for(t.attributes={},i=(s=Array.prototype.slice.call(e.attributes)).length,r=0;r<i;r++)t.attributes[(a=s[r]).name]=a.value;if("TEXTAREA"===t.nodeName)t.value=e.value;else if(e.childNodes&&e.childNodes.length>0)for(t.childNodes=[],i=(s=Array.prototype.slice.call(e.childNodes)).length,r=0;r<i;r++)t.childNodes.push(n.nodeToObj(o=s[r]));this.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?t.checked=e.checked:void 0!==e.value&&(t.value=e.value),void 0!==e.selected&&(t.selected=e.selected))}return t}objToNode(e,t){let n;const s=this;let o,i,a,r,l,c;if("#text"===e.nodeName)n=document.createTextNode(e.data);else if("#comment"===e.nodeName)n=document.createComment(e.data);else{if("svg"===e.nodeName||t?(n=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):n=document.createElement(e.nodeName),e.attributes)for(l=(i=Object.keys(e.attributes)).length,c=0;c<l;c++)n.setAttribute(o=i[c],e.attributes[o]);if(e.childNodes)for(l=(r=e.childNodes).length,c=0;c<l;c++)n.appendChild(s.objToNode(a=r[c],t));this.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))}return n}findInnerDiff(e,t,n){const o=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?function(e,t){const n=e.childNodes?e.childNodes:[],s=t.childNodes?t.childNodes:[],o=d(n.length,!1),i=d(s.length,!1),a=[];let r=!0;const l=function(){return arguments[1]},c=e=>{o[r.oldValue+e]=!0,i[r.newValue+e]=!0};for(;r;)(r=h(n,s,o,i))&&(a.push(r),Array(...new Array(r.length)).map(l).forEach(e=>c(e)));return e.subsets=a,e.subsetsAge=100,a}(e,t):[],i=e.childNodes?e.childNodes:[],a=t.childNodes?t.childNodes:[];let r,l=[],c=0;if(o.length>0&&(l=this.attemptGroupRelocation(e,t,o,n)).length>0)return l;const f=Math.max(i.length,a.length);i.length!==a.length&&(r=!0);for(let e=0;e<f;e+=1){const t=i[e],o=a[e];r&&(t&&!o?"#text"===t.nodeName?(l.push((new s).setValue(this._const.action,this._const.removeTextElement).setValue(this._const.route,n.concat(c)).setValue(this._const.value,t.data)),c-=1):(l.push((new s).setValue(this._const.action,this._const.removeElement).setValue(this._const.route,n.concat(c)).setValue(this._const.element,u(t))),c-=1):o&&!t&&l.push("#text"===o.nodeName?(new s).setValue(this._const.action,this._const.addTextElement).setValue(this._const.route,n.concat(c)).setValue(this._const.value,o.data):(new s).setValue(this._const.action,this._const.addElement).setValue(this._const.route,n.concat(c)).setValue(this._const.element,u(o)))),t&&o&&(l=l.concat(this.findNextDiff(t,o,n.concat(c)))),c+=1}return e.innerDone=!0,l}attemptGroupRelocation(e,t,n,o){const i=function(e,t,n){const s=e.childNodes?d(e.childNodes.length,!0):[],o=t.childNodes?d(t.childNodes.length,!0):[];let i=0;return n.forEach(e=>{const t=e.oldValue+e.length,n=e.newValue+e.length;for(let n=e.oldValue;n<t;n+=1)s[n]=i;for(let t=e.newValue;t<n;t+=1)o[t]=i;i+=1}),{gaps1:s,gaps2:o}}(e,t,n),a=i.gaps1,r=i.gaps2;let l,h,f,p,m,_,V=Math.min(a.length,r.length);const g=[];for(let i=0,d=0;i<V;d+=1,i+=1)if(!0===a[i])if("#text"===(p=e.childNodes[d]).nodeName){if("#text"===t.childNodes[i].nodeName&&p.data!==t.childNodes[i].data){for(_=d;e.childNodes.length>_+1&&"#text"===e.childNodes[_+1].nodeName;)if(t.childNodes[i].data===e.childNodes[_+=1].data){m=!0;break}if(!m)return g.push((new s).setValue(this._const.action,this._const.modifyTextElement).setValue(this._const.route,o.concat(i)).setValue(this._const.oldValue,p.data).setValue(this._const.newValue,t.childNodes[i].data)),g}g.push((new s).setValue(this._const.action,this._const.removeTextElement).setValue(this._const.route,o.concat(i)).setValue(this._const.value,p.data)),a.splice(i,1),V=Math.min(a.length,r.length),i-=1}else g.push((new s).setValue(this._const.action,this._const.removeElement).setValue(this._const.route,o.concat(i)).setValue(this._const.element,u(p))),a.splice(i,1),V=Math.min(a.length,r.length),i-=1;else if(!0===r[i])"#text"===(p=t.childNodes[i]).nodeName?(g.push((new s).setValue(this._const.action,this._const.addTextElement).setValue(this._const.route,o.concat(i)).setValue(this._const.value,p.data)),a.splice(i,0,!0),V=Math.min(a.length,r.length),d-=1):(g.push((new s).setValue(this._const.action,this._const.addElement).setValue(this._const.route,o.concat(i)).setValue(this._const.element,u(p))),a.splice(i,0,!0),V=Math.min(a.length,r.length),d-=1);else if(a[i]!==r[i]){if(g.length>0)return g;if(f=n[a[i]],(h=Math.min(f.newValue,e.childNodes.length-f.length))!==f.oldValue){l=!1;for(let t=0;t<f.length;t+=1)c(e.childNodes[h+t],e.childNodes[f.oldValue+t],[],!1,!0)||(l=!0);if(l)return[(new s).setValue(this._const.action,this._const.relocateGroup).setValue("groupLength",f.length).setValue(this._const.from,f.oldValue).setValue(this._const.to,h).setValue(this._const.route,o)]}}return g}findValueDiff(e,t,n){const o=[];return e.selected!==t.selected&&o.push((new s).setValue(this._const.action,this._const.modifySelected).setValue(this._const.oldValue,e.selected).setValue(this._const.newValue,t.selected).setValue(this._const.route,n)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&o.push((new s).setValue(this._const.action,this._const.modifyValue).setValue(this._const.oldValue,e.value||"").setValue(this._const.newValue,t.value||"").setValue(this._const.route,n)),e.checked!==t.checked&&o.push((new s).setValue(this._const.action,this._const.modifyChecked).setValue(this._const.oldValue,e.checked).setValue(this._const.newValue,t.checked).setValue(this._const.route,n)),o}applyVirtual(e,t){return t.forEach(t=>{this.applyVirtualDiff(e,t)}),!0}getFromVirtualRoute(e,t){let n,s,o=e;for(t=t.slice();t.length>0;){if(!o.childNodes)return!1;s=t.splice(0,1)[0],n=o,o=o.childNodes[s]}return{node:o,parentNode:n,nodeIndex:s}}applyVirtualDiff(e,t){const n=this.getFromVirtualRoute(e,t[this._const.route]);let s=n.node;const o=n.parentNode,i=n.nodeIndex,a=[],r={diff:t,node:s};if(this.preVirtualDiffApply(r))return!0;let l,c,h,d;switch(t[this._const.action]){case this._const.addAttribute:s.attributes||(s.attributes={}),s.attributes[t[this._const.name]]=t[this._const.value],"checked"===t[this._const.name]?s.checked=!0:"selected"===t[this._const.name]?s.selected=!0:"INPUT"===s.nodeName&&"value"===t[this._const.name]&&(s.value=t[this._const.value]);break;case this._const.modifyAttribute:s.attributes[t[this._const.name]]=t[this._const.newValue];break;case this._const.removeAttribute:delete s.attributes[t[this._const.name]],0===Object.keys(s.attributes).length&&delete s.attributes,"checked"===t[this._const.name]?s.checked=!1:"selected"===t[this._const.name]?delete s.selected:"INPUT"===s.nodeName&&"value"===t[this._const.name]&&delete s.value;break;case this._const.modifyTextElement:s.data=t[this._const.newValue];break;case this._const.modifyValue:s.value=t[this._const.newValue];break;case this._const.modifyComment:s.data=t[this._const.newValue];break;case this._const.modifyChecked:s.checked=t[this._const.newValue];break;case this._const.modifySelected:s.selected=t[this._const.newValue];break;case this._const.replaceElement:(l=u(t[this._const.newValue])).outerDone=!0,l.innerDone=!0,l.valueDone=!0,o.childNodes[i]=l;break;case this._const.relocateGroup:(c=s.childNodes.splice(t[this._const.from],t.groupLength).reverse()).forEach(e=>s.childNodes.splice(t[this._const.to],0,e)),s.subsets&&s.subsets.forEach(e=>{if(t[this._const.from]<t[this._const.to]&&e.oldValue<=t[this._const.to]&&e.oldValue>t[this._const.from]){e.oldValue-=t.groupLength;const n=e.oldValue+e.length-t[this._const.to];n>0&&(a.push({oldValue:t[this._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else if(t[this._const.from]>t[this._const.to]&&e.oldValue>t[this._const.to]&&e.oldValue<t[this._const.from]){e.oldValue+=t.groupLength;const n=e.oldValue+e.length-t[this._const.to];n>0&&(a.push({oldValue:t[this._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else e.oldValue===t[this._const.from]&&(e.oldValue=t[this._const.to])});break;case this._const.removeElement:o.childNodes.splice(i,1),o.subsets&&o.subsets.forEach(e=>{e.oldValue>i?e.oldValue-=1:e.oldValue===i?e.delete=!0:e.oldValue<i&&e.oldValue+e.length>i&&(e.oldValue+e.length-1===i?e.length--:(a.push({newValue:e.newValue+i-e.oldValue,oldValue:i,length:e.length-i+e.oldValue-1}),e.length=i-e.oldValue))}),s=o;break;case this._const.addElement:h=t[this._const.route].slice(),d=h.splice(h.length-1,1)[0],s=this.getFromVirtualRoute(e,h).node,(l=u(t[this._const.element])).outerDone=!0,l.innerDone=!0,l.valueDone=!0,s.childNodes||(s.childNodes=[]),d>=s.childNodes.length?s.childNodes.push(l):s.childNodes.splice(d,0,l),s.subsets&&s.subsets.forEach(e=>{if(e.oldValue>=d)e.oldValue+=1;else if(e.oldValue<d&&e.oldValue+e.length>d){const t=e.oldValue+e.length-d;a.push({newValue:e.newValue+e.length-t,oldValue:d+1,length:t}),e.length-=t}});break;case this._const.removeTextElement:o.childNodes.splice(i,1),"TEXTAREA"===o.nodeName&&delete o.value,o.subsets&&o.subsets.forEach(e=>{e.oldValue>i?e.oldValue-=1:e.oldValue===i?e.delete=!0:e.oldValue<i&&e.oldValue+e.length>i&&(e.oldValue+e.length-1===i?e.length--:(a.push({newValue:e.newValue+i-e.oldValue,oldValue:i,length:e.length-i+e.oldValue-1}),e.length=i-e.oldValue))}),s=o;break;case this._const.addTextElement:h=t[this._const.route].slice(),d=h.splice(h.length-1,1)[0],(l={}).nodeName="#text",l.data=t[this._const.value],(s=this.getFromVirtualRoute(e,h).node).childNodes||(s.childNodes=[]),d>=s.childNodes.length?s.childNodes.push(l):s.childNodes.splice(d,0,l),"TEXTAREA"===s.nodeName&&(s.value=t[this._const.newValue]),s.subsets&&s.subsets.forEach(e=>{if(e.oldValue>=d&&(e.oldValue+=1),e.oldValue<d&&e.oldValue+e.length>d){const t=e.oldValue+e.length-d;a.push({newValue:e.newValue+e.length-t,oldValue:d+1,length:t}),e.length-=t}});break;default:console.log("unknown action")}s.subsets&&(s.subsets=s.subsets.filter(e=>!e.delete&&e.oldValue!==e.newValue),a.length&&(s.subsets=s.subsets.concat(a))),r.newNode=l,this.postVirtualDiffApply(r)}apply(e,t){return t.every(t=>this.applyDiff(e,t))}getFromRoute(e,t){for(t=t.slice();t.length>0;){if(!e.childNodes)return!1;const n=t.splice(0,1)[0];e=e.childNodes[n]}return e}applyDiff(e,t){let n,s,o,i,a,r=this.getFromRoute(e,t[this._const.route]);const l={diff:t,node:r};if(this.preDiffApply(l))return!0;switch(t[this._const.action]){case this._const.addAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(t[this._const.name],t[this._const.value]);break;case this._const.modifyAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(t[this._const.name],t[this._const.newValue]),"INPUT"===r.nodeName&&"value"===t[this._const.name]&&(r.value=t[this._const.oldValue]);break;case this._const.removeAttribute:if(!r||!r.removeAttribute)return!1;r.removeAttribute(t[this._const.name]);break;case this._const.modifyTextElement:if(!r||3!==r.nodeType)return!1;this.textDiff(r,r.data,t[this._const.oldValue],t[this._const.newValue]);break;case this._const.modifyValue:if(!r||void 0===r.value)return!1;r.value=t[this._const.newValue];break;case this._const.modifyComment:if(!r||void 0===r.data)return!1;this.textDiff(r,r.data,t[this._const.oldValue],t[this._const.newValue]);break;case this._const.modifyChecked:if(!r||void 0===r.checked)return!1;r.checked=t[this._const.newValue];break;case this._const.modifySelected:if(!r||void 0===r.selected)return!1;r.selected=t[this._const.newValue];break;case this._const.replaceElement:r.parentNode.replaceChild(this.objToNode(t[this._const.newValue],"http://www.w3.org/2000/svg"===r.namespaceURI),r);break;case this._const.relocateGroup:(i=Array(...new Array(t.groupLength)).map(()=>r.removeChild(r.childNodes[t[this._const.from]]))).forEach((e,n)=>{0===n&&(s=r.childNodes[t[this._const.to]]),r.insertBefore(e,s||null)});break;case this._const.removeElement:r.parentNode.removeChild(r);break;case this._const.addElement:a=(o=t[this._const.route].slice()).splice(o.length-1,1)[0],(r=this.getFromRoute(e,o)).insertBefore(this.objToNode(t[this._const.element],"http://www.w3.org/2000/svg"===r.namespaceURI),r.childNodes[a]||null);break;case this._const.removeTextElement:if(!r||3!==r.nodeType)return!1;r.parentNode.removeChild(r);break;case this._const.addTextElement:if(a=(o=t[this._const.route].slice()).splice(o.length-1,1)[0],n=document.createTextNode(t[this._const.value]),!(r=this.getFromRoute(e,o))||!r.childNodes)return!1;r.insertBefore(n,r.childNodes[a]||null);break;default:console.log("unknown action")}return l.newNode=n,this.postDiffApply(l),!0}undo(e,t){t.length||(t=[t]),(t=t.slice()).reverse(),t.forEach(t=>{this.undoDiff(e,t)})}undoDiff(e,t){switch(t[this._const.action]){case this._const.addAttribute:t[this._const.action]=this._const.removeAttribute,this.applyDiff(e,t);break;case this._const.modifyAttribute:f(t,this._const.oldValue,this._const.newValue),this.applyDiff(e,t);break;case this._const.removeAttribute:t[this._const.action]=this._const.addAttribute,this.applyDiff(e,t);break;case this._const.modifyTextElement:case this._const.modifyValue:case this._const.modifyComment:case this._const.modifyChecked:case this._const.modifySelected:case this._const.replaceElement:f(t,this._const.oldValue,this._const.newValue),this.applyDiff(e,t);break;case this._const.relocateGroup:f(t,this._const.from,this._const.to),this.applyDiff(e,t);break;case this._const.removeElement:t[this._const.action]=this._const.addElement,this.applyDiff(e,t);break;case this._const.addElement:t[this._const.action]=this._const.removeElement,this.applyDiff(e,t);break;case this._const.removeTextElement:t[this._const.action]=this._const.addTextElement,this.applyDiff(e,t);break;case this._const.addTextElement:t[this._const.action]=this._const.removeTextElement,this.applyDiff(e,t);break;default:console.log("unknown action")}}}({preVirtualDiffApply:function(e){},preDiffApply:function(e){if("modifyValue"===e.diff.action)return!0}}),E=(y=function(e){return!(e[1]instanceof D)},function(e){return Object.entries(e).reduce(function(t,n){var s,o=n[0],i=n[1];return y([o,i],e)?Object.assign(t,((s={})[o]=i,s)):t},{})}),C=function(e){return e instanceof D?e:new D({fnComponent:e}).init()},D=function(e){void 0===e&&(e={}),this.parent=null,this.props={},this.lastRenderSnapshot="",this.lastComponentsSnapshot={},this.mounted=!1,this.preRenderResult="",this.propsFunc=function(){return{}},this.renderOption=e,this.initProps(e.props)};D.prototype.init=function(){return this.preRenderForFunction(),this.lastComponentsSnapshot=this.safeComponents(),this.update(),this.lastRenderSnapshot=this.render(),this},D.prototype.components=function(){return{}},D.prototype.didMount=function(){},D.prototype.didUpdate=function(){},D.prototype.willUnMount=function(){},D.prototype.shouldUpdate=function(){},D.prototype.render=function(e,t){return void 0===e&&(e=this.props),void 0===t&&(t=this.state),this.renderOption.fnComponent?(N.clear(),N.activeComponent=this,this.mounted?this.renderOption.fnComponent():this.preRenderResult):"<div></div>"},D.prototype.setState=function(e){var t,n=this;if(!(t="function"==typeof e?e(Object.assign({},this.state)):e))throw new Error("invalid state!");if("function"==typeof e)return this.state=t,this.update();var s=Object.entries(t).reduce(function(e,t){var s,o=t[0],i=t[1];if(!(o in n.state))return e;var a=i!==n.state[o];return{newState:Object.assign(e.newState,(s={},s[o]=i,s)),hasChanged:e.hasChanged||a}},{hasChanged:!1,newState:this.state});s.hasChanged&&(this.state=s.newState,this.update())},D.prototype.updateSelf=function(){if(this.shouldUpdateSelf()){var e=this.renderOption.el,t=this.ref,n=this.render();if(this.lastRenderSnapshot=n,n&&n.trim()){var s=g(n);if(t)return this.hasChildren()&&this.replaceSlotWithChild(this.lastComponentsSnapshot,s,!1),void this.patch(s);this.ref=s,!!e&&"string"==typeof e&&(b(e).appendChild(this.ref),this.mounted||this.mount())}}},D.prototype.update=function(){this.props=this.propsFunc(),this.updateChildren(),this.updateSelf()},D.prototype.updateChildren=function(){var e=this,t=this.safeComponents();if(this.hasChildren(t)){var n=this.lastComponentsSnapshot;Object.entries(t).forEach(function(t){var s=t[0],o=t[1],i=n[s];if(Array.isArray(o)&&Array.isArray(i)){o.forEach(function(t){return e.initChild(t)});var a=i.length,r=o.length,l=function e(t,n,s){void 0===s&&(s=0);var o=t.length,i=n.length;if(o===i)return t.reduce(function(e,t,o){var i=n[o];return"function"==typeof t&&"function"==typeof i?e:m(t)!==m(i)?e.concat([{index:o+s,oldValue:t,newValue:i,type:"E"}]):e},[]);if(o>i){if(0===i)return t.map(function(e,t){return{index:t+s,oldValue:e,newValue:void 0,type:"D"}});var a=_(t,n);return a.length===i?t.reduce(function(e,t,n){return a.some(function(e){return e[0]===n})?e:{index:n+s,oldValue:t,newValue:void 0,type:"D"}},[]):e(t.slice(0,i),n).concat(e(t.slice(i),[],i))}if(0===o)return n.map(function(e,t){return{index:t+s,oldValue:void 0,newValue:e,type:"A"}});var r=_(t,n);return r.length===o?n.reduce(function(e,t,n){return r.some(function(e){return e[1]===n})?e:e.concat([{index:n+s,oldValue:void 0,newValue:t,type:"A"}])},[]):e(t,n.slice(0,o)).concat(e([],n.slice(o),o))}(i.map(function(e){return e.props}).map(E),o.map(function(e){return e.props}).map(E)).reduce(function(e,t){return"E"===t.type&&e.update.push(t),"D"===t.type&&e.del.push(t),"A"===t.type&&e.add.push(t),e},{update:[],add:[],del:[]}),c=l.add,u=l.del;if(l.update.forEach(function(e){var t=e.index,n=i[t];n.propsFunc=o[t].propsFunc,n.update()}),c.length&&c.length===r+a){var h=b(s,e.ref);h&&v(h,o.map(function(e){return e.ref})),o.forEach(function(e){return e.mount()}),e.lastComponentsSnapshot[s]=o}else{var d=i.map(function(e){return e.ref});c.forEach(function(t,n){var r=t.index,l=o[r];r<a?(!function(e,t){if("jQuery"in window)$(t).insertBefore(e);else{var n=e.parentElement;n&&n.insertBefore(t,e)}}(d[r],l.ref),e.lastComponentsSnapshot[s].splice(r+n,0,l)):(!function(e,t){if("jQuery"in window)$(t).insertAfter(e);else{var n=e.parentElement;if(n){var s=e.nextElementSibling;s?n.insertBefore(t,s):n.appendChild(t)}}}(r===a?i[a-1].ref:o[r-1].ref,l.ref),e.lastComponentsSnapshot[s][r]=l);l.mount()})}var f=u.length===a;u.forEach(function(t,n){var o=t.index,r=i[o];if(e.lastComponentsSnapshot[s].splice(o-n,1),r.willUnMount(),f&&o===a-1)return v(r.ref,g(s));!function(e){if("jQuery"in window)$(e).remove();else{var t=e.parentElement;t&&t.removeChild(e)}}(r.ref)})}else Array.isArray(o)||Array.isArray(i)||(i.propsFunc=o.propsFunc,i.update())})}},D.prototype.hasChildren=function(e){return void 0===e&&(e=this.lastComponentsSnapshot),Object.keys(e).length>0},D.prototype.safeComponents=function(){return Object.entries(this.components()).reduce(function(e,t){var n=t[0],s=t[1];return e[n]=Array.isArray(s)?s.map(C):C(s),e},{})},D.prototype.initChild=function(e){e.parent=this},D.prototype.preRenderForFunction=function(){if(this.renderOption.fnComponent&&"function"==typeof this.renderOption.fnComponent&&(N.clear(),N.activeComponent=this,this.preRenderResult=this.renderOption.fnComponent(),this.state=N.makeState(),N.effectList.length)){var e=N.effectList.pop(),t=e[0],n=e[1];"function"==typeof t&&(this.didMount=t),"function"==typeof n&&(this.willUnMount=n)}},D.prototype.replaceSlotWithChild=function(e,t,n){var s=this;void 0===t&&(t=this.ref),void 0===n&&(n=!0),Object.entries(e).forEach(function(e){var o=e[0],i=e[1],a=null;if(Array.isArray(i)?i.length&&(i.forEach(function(e){return s.initChild(e)}),a=i.map(function(e){return n?e.ref:g(e.ref.outerHTML)})):(s.initChild(i),i.ref&&(a=n?i.ref:g(i.ref.outerHTML))),a){var r=b(o,t);r&&v(r,a)}n&&(Array.isArray(i)?i.forEach(function(e){e.ref&&e.mount()}):i.ref&&i.mount())})},D.prototype.shouldUpdateSelf=function(){var e=this.shouldUpdate();return"boolean"==typeof e?e:this.render()!==this.lastRenderSnapshot},D.prototype.initProps=function(e){e&&("function"==typeof e?(this.propsFunc=e,this.props=e()):(this.props=e,this.propsFunc=function(){return e}))},D.prototype.updateChain=function(){this.didUpdate(),this.parent&&this.parent instanceof D&&this.parent.updateChain()},D.prototype.register=function(){this.replaceSlotWithChild(this.lastComponentsSnapshot)},D.prototype.mount=function(){this.register(),this.didMount(),this.mounted=!0},D.prototype.patch=function(e){var t=w.diff(this.ref,e);w.apply(this.ref,t),this.updateChain()};var k=function(){};e.Component=D,e.render=function(e,t){return new t({el:e}).init()},e.useState=function(e){var t=N.activeComponent,n=N.stateList,s=n.length,o=[function(){return t&&t.state?t.state[s]:e},function(e){var n;t&&t.setState(((n={})[s]=e,n))}];return n.push(e),o},e.useEffect=function(e){var t=N.activeComponent;if(t&&!t.mounted){var n=k;N.effectList.push([function(){n=e(t.ref)},function(){"function"==typeof n&&n()}])}},e.register=function(e){N.activeComponent&&(N.activeComponent.components=e)}});
//# sourceMappingURL=index.umd.js.map
